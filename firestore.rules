rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Règles pour la collection 'characters'
    match /characters/{userId} {
      // Lecture : L'utilisateur peut lire son propre personnage ou tout admin
      allow read: if request.auth != null &&
                     (request.auth.uid == userId ||
                      request.auth.token.email == 'antho.pruneta@gmail.com');

      // Écriture : L'utilisateur peut créer/modifier son propre personnage
      allow write: if request.auth != null && request.auth.uid == userId;

      // Suppression : Seulement les admins
      allow delete: if request.auth != null &&
                       request.auth.token.email == 'antho.pruneta@gmail.com';
    }

    // Règle pour permettre aux admins de lister tous les personnages
    match /characters/{document=**} {
      allow read: if request.auth != null &&
                     request.auth.token.email == 'antho.pruneta@gmail.com';
    }
  }
}
